---
description: 
globs: 
alwaysApply: true
---
---
id: rule.structure
title: Feature Sliced Architecture â€” Feature Structure
description: Canonical structure and folder conventions for organizing a feature using FSD.
tags: [architecture, fsd, folders, convention, scalable]
---

# âœ… Feature-Sliced Architecture â€” Feature Structure

We adopt a **Feature-Sliced Design (FSD)** architecture that maximizes modularity, clarity, testability, and scalability across all business features.

Each business **feature** (`invoice`, `client`, `user`, etc.) is structured into subfolders that reflect **user intents** (`create`, `edit`, `list`, `view`, etc.), and shares logic internally via a `shared/` folder.  
Global logic is always extracted into the root-level `shared/`.

---

## ğŸ“¦ Canonical Structure Example

```bash
features/
â””â”€â”€ invoice/
    â”œâ”€â”€ create/
    â”‚   â”œâ”€â”€ ui/              # UI components specific to create flow
    â”‚   â”œâ”€â”€ actions/         # Server actions (Next.js "use server")
    â”‚   â””â”€â”€ schema/          # Zod validation for create

    â”œâ”€â”€ edit/
    â”‚   â”œâ”€â”€ ui/
    â”‚   â”œâ”€â”€ actions/
    â”‚   â””â”€â”€ schema/

    â”œâ”€â”€ list/
    â”‚   â”œâ”€â”€ actions/         # getAllInvoices.action.ts
    â”‚   â””â”€â”€ model/           # fetchAllInvoices.ts

    â”œâ”€â”€ view/
    â”‚   â”œâ”€â”€ actions/         # getInvoice.action.ts
    â”‚   â””â”€â”€ model/           # fetchInvoiceById, fetchUserCurrency, etc.

    â”œâ”€â”€ shared/
    â”‚   â”œâ”€â”€ model/           # DB access: createInvoiceInDb, deleteInvoiceById, etc.
    â”‚   â”œâ”€â”€ hooks/           # React logic: useInvoiceForm, useInvoiceStatusColor
    â”‚   â”œâ”€â”€ types/           # Domain types: Invoice, InvoiceItem, InvoiceStatus, etc.
    â”‚   â”œâ”€â”€ schema/          # Shared Zod schemas: invoice.base.schema.ts
    â”‚   â””â”€â”€ lib/             # Utility functions: formatInvoiceDate, computeInvoiceTotals
ğŸ§± Folder Responsibilities
Folder	Responsibility
create/	UI, validation & server action for invoice creation
edit/	UI & logic for editing an invoice
view/	Load & display invoice in readonly mode
list/	Fetch & display multiple invoices
shared/	Internal feature logic reused across the sub-intents (create, edit, view)

ğŸ“š Shared Folder Breakdown
Use shared/ within the feature (e.g. invoice/shared/) for logic thatâ€™s reused inside the feature only.
Use shared/ at the root of the project for cross-feature logic (auth, i18n, formatting, etc).

Subfolder	Responsibility
model/	Raw DB access & Supabase interaction functions (fetch, createâ€¦)
hooks/	Custom UI logic for state management
schema/	Shared Zod schema definitions
types/	TypeScript domain types
lib/	Pure utilities / formatting logic

âš™ï¸ Naming Conventions
Context	Convention	Example
Server action	*.action.ts	createInvoice.action.ts
DB interaction	verbEntity[InDb].ts	fetchInvoiceById.ts
React Hook	use*	useInvoiceForm.ts
Zod Schema	*.schema.ts	invoice.base.schema.ts
Pure util function	verbEntity.ts	formatInvoiceDate.ts

ğŸ”„ Global shared/ (at root)
Logic that is reused across multiple features must live in the global shared/ folder at the root.

bash
Copier
Modifier
shared/
â”œâ”€â”€ lib/              # Pure functions by domain (auth, date, currency, etc.)
â”‚   â”œâ”€â”€ auth/         # getUserIdFromSession.ts, hasRole.ts
â”‚   â”œâ”€â”€ date/
â”‚   â”œâ”€â”€ currency/
â”œâ”€â”€ schema/           # Global Zod schemas
â”œâ”€â”€ types/            # Global types like User, Role, etc.
â”œâ”€â”€ services/         # External integrations (e.g. Stripe, Supabase client)
â”œâ”€â”€ ui/               # Reusable UI components (Button, Modal, etc.)
â”œâ”€â”€ config/           # Theme, locale, env
ğŸ§  Decision Rules
âœ… Use features/invoice/shared/ â†’ for invoice-specific logic reused across create/edit/view

âœ… Use shared/lib/auth/ â†’ for things like getUserIdFromSession, getUserLocale, etc.

âŒ Do not place cross-feature utilities inside a featureâ€™s shared folder

âŒ Never mix intent folders (e.g. donâ€™t call getInvoiceById from edit/ if it lives in create/)

ğŸ§ª Testing Readiness
Each file should be testable in isolation:

model/ and lib/ â†’ unit tested with Supabase/client mocks

actions/ â†’ tested at integration level (or via E2E flows)

hooks/ â†’ tested with React Testing Library if needed

âœ… Summary
Feature structure is modular, intention-based, and horizontally extensible.

Scope	Folder	Purpose
Local logic	features/invoice/shared/	Specific to one feature
Global logic	shared/ (root)	Cross-feature utilities and services


This rule ensures all features are consistently structured, scalable, and team-ready.